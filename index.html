<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Structural Design</title>
    <style>
        :root {
            /* UNIVERSITY OF MINDANAO PALETTE (Approx) */
            --primary: #800000;   /* UM Maroon */
            --primary-dark: #580000;
            --accent: #FFD700;    /* UM Gold */
            --accent-dark: #D4AF37;
            
            --secondary: #333333; /* Dark Gray for secondary nav */
            --light: #f4f6f7;
            --success: #27ae60;
            --danger: #c0392b;
            --warning: #f39c12;
            --border: #dcdcdc;
        }

        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: var(--light); 
            color: #333;
            -webkit-font-smoothing: antialiased;
        }
        
        /* HEADER DESIGN */
        header { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white; 
            padding: 1.5rem 2rem; 
            border-bottom: 5px solid var(--accent); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .header-content { 
            max-width: 1000px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-wrap: wrap; 
            gap: 1.5rem; 
        }

        .app-title { 
            font-size: 1.8rem; 
            font-weight: 800; 
            letter-spacing: 1px; 
            text-transform: uppercase;
        }
        
        .app-subtitle { 
            font-size: 0.85rem; 
            opacity: 0.9; 
            margin-top: 5px; 
            color: var(--accent); /* Gold subtitle */
            font-weight: 600;
        }
        
        /* REFINED STUDENT INFO CARD */
        .student-info { 
            background-color: rgba(0, 0, 0, 0.25); 
            padding: 12px 20px; 
            border-radius: 8px; 
            font-size: 0.9rem;
            border-left: 4px solid var(--accent);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        
        .info-row {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        .info-row:last-child { margin-bottom: 0; }

        .info-label { 
            color: var(--accent); 
            font-weight: 700; 
            margin-right: 10px; 
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            width: 70px; /* Fixed width for alignment */
        }
        
        .info-val { 
            font-weight: 600; 
            color: white; 
            letter-spacing: 0.5px;
        }

        /* NAVIGATION */
        nav { 
            background-color: var(--secondary); 
            display: flex; 
            justify-content: center; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
        }
        
        nav button { 
            background: none; 
            border: none; 
            color: rgba(255,255,255,0.7); 
            padding: 1rem 2.5rem; 
            cursor: pointer; 
            font-size: 1rem; 
            font-weight: 700; 
            transition: all 0.3s; 
            border-bottom: 4px solid transparent; 
            text-transform: uppercase;
        }
        
        nav button:hover { 
            color: var(--accent); 
            background-color: rgba(255,255,255,0.05); 
        }
        
        nav button.active { 
            color: white; 
            border-bottom-color: var(--accent); 
            background-color: rgba(255,255,255,0.1); 
        }
        
        @media (max-width: 600px) { 
            nav button { padding: 1rem 0.5rem; font-size: 0.8rem; flex: 1; } 
            .header-content { justify-content: center; text-align: center; }
            .student-info { width: 100%; text-align: left; }
        }

        /* CONTENT */
        main { max-width: 900px; margin: 2rem auto; padding: 0 1rem; padding-bottom: 4rem; }
        
        .module { 
            display: none; 
            background: white; 
            padding: 2.5rem; 
            border-radius: 8px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
            animation: fadeIn 0.4s ease-out; 
            border-top: 4px solid var(--primary);
        }
        
        .module.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { 
            border-bottom: 2px solid #eee; 
            padding-bottom: 0.8rem; 
            color: var(--primary); 
            margin-top: 0; 
            font-size: 1.5rem; 
            font-weight: 700;
        }
        
        h3 { 
            color: #555; 
            margin-top: 2rem; 
            font-size: 1rem; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            border-left: 4px solid var(--accent);
            padding-left: 10px;
        }

        .input-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        @media (max-width: 480px) { .input-grid { grid-template-columns: 1fr; gap: 1rem; } }

        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 0.85rem; font-weight: 700; margin-bottom: 0.5rem; color: #666; }
        .form-group input, .form-group select { 
            padding: 12px; 
            border: 1px solid var(--border); 
            border-radius: 4px; 
            font-size: 1rem; 
            background-color: #fff; 
            width: 100%; 
            transition: border 0.3s;
        }
        .form-group input:focus, .form-group select:focus { 
            border-color: var(--primary); 
            box-shadow: 0 0 0 3px rgba(128, 0, 0, 0.1); 
            outline: none; 
        }

        /* BUTTONS */
        .btn-calc { 
            width: 100%; 
            padding: 1.2rem; 
            background: var(--primary); 
            color: white; 
            border: none; 
            border-radius: 6px; 
            font-size: 1.1rem; 
            font-weight: 800; 
            cursor: pointer; 
            margin-top: 1.5rem; 
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .btn-calc:hover { 
            background-color: var(--primary-dark); 
            color: var(--accent);
            transform: translateY(-2px);
        }
        .btn-calc:active { transform: translateY(1px); }

        /* RESULTS BOX */
        .results-box { 
            margin-top: 2.5rem; 
            background-color: #fff; 
            border: 1px solid #ddd; 
            border-left: 6px solid var(--primary); 
            border-radius: 6px; 
            display: none; 
            overflow: hidden; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .result-header { 
            background-color: var(--primary); 
            color: white;
            padding: 1rem 1.5rem; 
            font-weight: bold; 
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-body { padding: 1.5rem; }
        
        .result-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0.9rem 0; 
            border-bottom: 1px solid #f0f0f0; 
            flex-wrap: wrap; 
            gap: 10px; 
        }
        .result-row:last-child { border-bottom: none; }
        
        .result-label { font-weight: 600; color: #444; }
        
        .tag { padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 800; color: white; text-transform: uppercase; letter-spacing: 0.5px; }
        .tag.pass { background-color: var(--success); }
        .tag.fail { background-color: var(--danger); }
        .tag.warn { background-color: var(--warning); }
        .tag.info { background-color: var(--primary); }
        
        .section-divider {
            background: #f9f9f9; color: var(--primary); padding: 8px 12px; font-size: 0.85rem; font-weight: 800; text-transform: uppercase; margin-top: 1.5rem; border-radius: 4px; border-left: 4px solid var(--accent);
        }

        .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-top: 1rem; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 500px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        th { background-color: #f8f8f8; color: var(--primary); font-weight: 800; text-transform: uppercase; font-size: 0.8rem; }
        tr:hover { background-color: #fcfcfc; }
    </style>
</head>
<body>

<header>
    <div class="header-content">
        <div>
            <div class="app-title">STRUCTURAL DESIGN CALCULATOR</div>
            <div class="app-subtitle">NSCP 2015 / ACI 318-14 (ZONE 4 READY)</div>
        </div>
        
        <div class="student-info">
            <div class="info-row"><span class="info-label">Project</span> <span id="display-project" class="info-val">...</span></div>
            <div class="info-row"><span class="info-label">Name</span> <span id="display-name" class="info-val">...</span></div>
            <div class="info-row"><span class="info-label">Subject</span> <span id="display-subject" class="info-val">...</span></div>
        </div>
    </div>
</header>

<nav>
    <button class="active" onclick="switchTab('beam')">BEAM</button>
    <button onclick="switchTab('column')">COLUMN</button>
    <button onclick="switchTab('slab')">SLAB</button>
</nav>

<main>
    <section id="beam" class="module active">
        <h2>Beam Design Module</h2>
        
        <h3>1. Geometry & Materials</h3>
        <div class="input-grid">
            <div class="form-group"><label>Width b (mm)</label><input type="number" id="b_b" value="300"></div>
            <div class="form-group"><label>Depth h (mm)</label><input type="number" id="b_h" value="500"></div>
            <div class="form-group"><label>Cover (mm)</label><input type="number" id="b_cc" value="40"></div>
            <div class="form-group"><label>fc' (MPa)</label><input type="number" id="b_fc" value="28"></div>
            <div class="form-group"><label>Main fy (MPa)</label><input type="number" id="b_fy" value="414"></div>
            <div class="form-group"><label>Stirrup fyt (MPa)</label><input type="number" id="b_fyt" value="275"></div>
        </div>

        <h3>2. Tension Reinforcement</h3>
        <div class="input-grid">
            <div class="form-group"><label>No. of Bars (N)</label><input type="number" id="b_n" value="3"></div>
            <div class="form-group"><label>Bar Dia (mm)</label><input type="number" id="b_db" value="20"></div>
            <div class="form-group"><label>Stirrup Dia (mm)</label><input type="number" id="b_ds" value="10"></div>
        </div>

        <h3>3. Compression Reinforcement</h3>
        <p style="font-size:0.8rem; color:#666; margin-top:-10px; font-style:italic;">*Set to 0 for Singly Reinforced Analysis</p>
        <div class="input-grid">
            <div class="form-group"><label>No. Comp. Bars (N')</label><input type="number" id="b_np" value="0"></div>
            <div class="form-group"><label>Comp. Bar Dia (mm)</label><input type="number" id="b_dbp" value="20"></div>
            <div class="form-group"><label>Dist to Top d' (mm)</label><input type="number" id="b_dp" value="60"></div>
        </div>

        <h3>4. Loads & Span</h3>
        <div class="input-grid">
            <div class="form-group"><label>Moment Mu (kNm)</label><input type="number" id="b_Mu" value="150"></div>
            <div class="form-group"><label>Shear Vu (kN)</label><input type="number" id="b_Vu" value="100"></div>
            <div class="form-group"><label>Torsion Tu (kNm)</label><input type="number" id="b_Tu" value="0"></div>
            <div class="form-group"><label>Span Length (m)</label><input type="number" id="b_L" value="6.0"></div>
            <div class="form-group"><label>Support Type</label>
                <select id="b_supp">
                    <option value="1">Simply Supported</option>
                    <option value="2">One End Continuous</option>
                    <option value="3">Both Ends Continuous</option>
                    <option value="4">Cantilever</option>
                </select>
            </div>
        </div>
        <button class="btn-calc" onclick="calculateBeam()">ANALYZE BEAM</button>
        <div id="beam-results" class="results-box"></div>
    </section>

    <section id="column" class="module">
        <h2>Column Design Module</h2>
        <h3>1. Geometry</h3>
        <div class="input-grid">
            <div class="form-group"><label>Shape</label>
                <select id="c_shape" onchange="toggleColInputs()">
                    <option value="rect">Rectangular</option>
                    <option value="circ">Circular</option>
                </select>
            </div>
            <div class="form-group" id="c_b_grp"><label>Width (mm)</label><input type="number" id="c_b" value="400"></div>
            <div class="form-group" id="c_h_grp"><label>Depth (mm)</label><input type="number" id="c_h" value="400"></div>
            <div class="form-group" id="c_D_grp" style="display:none"><label>Diameter (mm)</label><input type="number" id="c_D" value="400"></div>
            <div class="form-group"><label>Cover (mm)</label><input type="number" id="c_cc" value="40"></div>
        </div>
        <h3>2. Material & Reinforcement</h3>
        <div class="input-grid">
            <div class="form-group"><label>fc' (MPa)</label><input type="number" id="c_fc" value="28"></div>
            <div class="form-group"><label>fy (MPa)</label><input type="number" id="c_fy" value="415"></div>
            <div class="form-group"><label>No. Bars</label><input type="number" id="c_nb" value="8"></div>
            <div class="form-group"><label>Bar Dia (mm)</label><input type="number" id="c_db" value="20"></div>
            <div class="form-group"><label>Tie Type</label>
                <select id="c_tie"><option value="tied">Tied</option><option value="spiral">Spiral</option></select>
            </div>
            <div class="form-group"><label>Tie Dia (mm)</label><input type="number" id="c_dt" value="10"></div>
        </div>
        <h3>3. Loads & Slenderness</h3>
        <div class="input-grid">
            <div class="form-group"><label>Axial Pu (kN)</label><input type="number" id="c_Pu" value="1000"></div>
            <div class="form-group"><label>Top Moment M2 (kNm)</label><input type="number" id="c_M2" value="150"></div>
            <div class="form-group"><label>Bot Moment M1 (kNm)</label><input type="number" id="c_M1" value="0"></div>
            <div class="form-group"><label>Unbraced Length (m)</label><input type="number" id="c_Lu" value="3.0"></div>
            <div class="form-group"><label>K Factor</label><input type="number" id="c_k" value="1.0"></div>
            <div class="form-group"><label>Frame Type</label>
                <select id="c_sway"><option value="0">Non-Sway</option><option value="1">Sway</option></select>
            </div>
        </div>
        <button class="btn-calc" onclick="calculateColumn()">ANALYZE COLUMN</button>
        <div id="col-results" class="results-box"></div>
    </section>

    <section id="slab" class="module">
        <h2>Slab Design Module</h2>
        <h3>1. Configuration</h3>
        <div class="form-group"><label>Design Method</label>
            <select id="s_mode" onchange="toggleSlabInputs()">
                <option value="1">One-Way Slab</option>
                <option value="2">Two-Way Slab (Coefficient Method)</option>
            </select>
        </div>
        <h3>2. Materials & Load</h3>
        <div class="input-grid">
            <div class="form-group"><label>fc' (MPa)</label><input type="number" id="s_fc" value="21"></div>
            <div class="form-group"><label>fy (MPa)</label><input type="number" id="s_fy" value="275"></div>
            <div class="form-group"><label>Thickness (mm)</label><input type="number" id="s_h" value="125"></div>
            <div class="form-group"><label>Cover (mm)</label><input type="number" id="s_cc" value="20"></div>
            <div class="form-group"><label>Bar Dia (mm)</label><input type="number" id="s_db" value="10"></div>
            <div class="form-group"><label>Superimposed DL (kPa)</label><input type="number" id="s_DL" value="1.5"></div>
            <div class="form-group"><label>Live Load (kPa)</label><input type="number" id="s_LL" value="1.9"></div>
        </div>
        
        <div id="slab-oneway">
            <h3>3. One-Way Parameters</h3>
            <div class="input-grid">
                <div class="form-group"><label>Clear Span (m)</label><input type="number" id="s_L" value="3.0"></div>
                <div class="form-group"><label>Support</label>
                    <select id="s_supp">
                        <option value="0.125">Simply Supported (1/8)</option>
                        <option value="0.10">One End Continuous (1/10)</option>
                        <option value="0.0833">Both Ends Continuous (1/12)</option>
                        <option value="0.5">Cantilever (1/2)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div id="slab-twoway" style="display:none;">
            <h3>3. Two-Way Parameters</h3>
            <div class="input-grid">
                <div class="form-group"><label>Short Span Lx (m)</label><input type="number" id="s_Lx" value="3.0"></div>
                <div class="form-group"><label>Column D (mm) [Punching]</label><input type="number" id="s_col_w" value="400"></div>
            </div>
            <h4>Moment Coefficients (Table)</h4>
            <div class="input-grid">
                <div class="form-group"><label>Short Span Neg (-)</label><input type="number" id="s_cn_s" value="0.0"></div>
                <div class="form-group"><label>Short Span Pos (+)</label><input type="number" id="s_cp_s" value="0.05"></div>
                <div class="form-group"><label>Long Span Neg (-)</label><input type="number" id="s_cn_l" value="0.0"></div>
                <div class="form-group"><label>Long Span Pos (+)</label><input type="number" id="s_cp_l" value="0.05"></div>
            </div>
        </div>
        <button class="btn-calc" onclick="calculateSlab()">ANALYZE SLAB</button>
        <div id="slab-results" class="results-box"></div>
    </section>
</main>

<script>
    // ==========================================
    //       USER CONFIGURATION (EDIT HERE)
    // ==========================================
    const PROJECT_DETAILS = {
        project: "FINAL PROPOSAL",       
        name:    "ENGR. JAN FROYD R. ITEM",    
        subject: "MEPCE 225"        
    };

    window.onload = function() {
        document.getElementById('display-project').textContent = PROJECT_DETAILS.project;
        document.getElementById('display-name').textContent = PROJECT_DETAILS.name;
        document.getElementById('display-subject').textContent = PROJECT_DETAILS.subject;
    };

    function switchTab(tabId) {
        document.querySelectorAll('.module').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
    }

    function toggleColInputs() {
        const shape = document.getElementById('c_shape').value;
        const isRect = shape === 'rect';
        document.getElementById('c_b_grp').style.display = isRect ? 'flex' : 'none';
        document.getElementById('c_h_grp').style.display = isRect ? 'flex' : 'none';
        document.getElementById('c_D_grp').style.display = isRect ? 'none' : 'flex';
    }

    function toggleSlabInputs() {
        const mode = document.getElementById('s_mode').value;
        document.getElementById('slab-oneway').style.display = mode === '1' ? 'block' : 'none';
        document.getElementById('slab-twoway').style.display = mode === '2' ? 'block' : 'none';
    }

    function createRow(label, val, status) {
        let tagClass = 'info';
        if(['PASS','SAFE','DUCTILE','SHORT','YIELD'].includes(status)) tagClass = 'pass';
        if(['FAIL','UNSAFE','SLENDER','TRANSITION','ELASTIC'].includes(status)) tagClass = 'fail';
        return `
        <div class="result-row">
            <span class="result-label">${label}</span>
            <span>${val} ${status ? `<span class="tag ${tagClass}">${status}</span>` : ''}</span>
        </div>`;
    }

    // --- BEAM CALCULATION ---
    function calculateBeam() {
        const b = parseFloat(document.getElementById('b_b').value);
        const h = parseFloat(document.getElementById('b_h').value);
        const cc = parseFloat(document.getElementById('b_cc').value);
        const fc = parseFloat(document.getElementById('b_fc').value);
        const fy = parseFloat(document.getElementById('b_fy').value);
        const fyt = parseFloat(document.getElementById('b_fyt').value);
        const L = parseFloat(document.getElementById('b_L').value);
        const supp = parseInt(document.getElementById('b_supp').value);
        const db = parseFloat(document.getElementById('b_db').value);
        const n = parseFloat(document.getElementById('b_n').value);
        const ds = parseFloat(document.getElementById('b_ds').value);
        const np = parseFloat(document.getElementById('b_np').value);
        const dbp = parseFloat(document.getElementById('b_dbp').value);
        const dp = parseFloat(document.getElementById('b_dp').value);
        const Mu = parseFloat(document.getElementById('b_Mu').value);
        const Vu = parseFloat(document.getElementById('b_Vu').value);
        const Tu = parseFloat(document.getElementById('b_Tu').value);

        const d = h - cc - ds - (db/2);
        const As = n * Math.PI * Math.pow(db/2, 2);
        let Asp = 0;
        let isDoubly = false;

        if (np > 0) { isDoubly = true; Asp = np * Math.PI * Math.pow(dbp/2, 2); }

        let html = `<div class="result-header">BEAM ANALYSIS RESULTS (${isDoubly ? 'DOUBLY' : 'SINGLY'})</div><div class="result-body">`;

        // 1. Serviceability
        const denom = {1:16, 2:18.5, 3:21, 4:8}[supp] || 16;
        const mod = 0.4 + (fy/700);
        const h_min = (L * 1000) / denom * mod;
        html += createRow("Min Thickness Req", h_min.toFixed(0) + " mm", h >= h_min ? "PASS" : "FAIL");

        // 2. Development Length
        let ld_factor = (db >= 20) ? 50 : 40; 
        const ld_calc = (fy / (1.1 * Math.sqrt(fc))) * db; 
        html += createRow("Dev. Length (Ld)", ld_calc.toFixed(0) + " mm", "");

        // 3. Flexural Analysis
        let beta1 = fc <= 28 ? 0.85 : Math.max(0.65, 0.85 - 0.05*(fc-28)/7);
        let c, a, Mn, et, phi, fs_prime;
        
        if (!isDoubly) {
            a = (As * fy) / (0.85 * fc * b);
            c = a / beta1;
            Mn = (As * fy * (d - a/2)) / 1e6;
        } else {
            const Es = 200000;
            let c_trial = d / 3; 
            for(let i=0; i<50; i++) {
                let es_prime = 0.003 * (c_trial - dp)/c_trial;
                let fsp = Math.min(Math.max(es_prime * Es, -fy), fy);
                let Cc = 0.85 * fc * beta1 * c_trial * b;
                let Cs = Asp * (fsp - 0.85*fc);
                let T = As * fy;
                let residual = Cc + Cs - T;
                if(Math.abs(residual) < 100) break;
                c_trial = c_trial - residual / (0.85*fc*beta1*b);
            }
            c = c_trial;
            a = beta1 * c;
            let es_prime = 0.003 * (c - dp)/c;
            fs_prime = Math.min(Math.max(es_prime * Es, -fy), fy);
            let Cc = 0.85 * fc * a * b;
            let Cs = Asp * (fs_prime - 0.85*fc);
            Mn = (Cc * (d - a/2) + Cs * (d - dp)) / 1e6;
            html += createRow("Comp. Steel Stress", fs_prime.toFixed(1) + " MPa", fs_prime >= fy ? "YIELD" : "ELASTIC");
        }

        et = 0.003 * ((d - c)/c);
        phi = 0.90;
        if(et <= 0.002) phi = 0.65;
        else if(et < 0.005) phi = 0.65 + (et - 0.002)*(250/3);
        const PhiMn = phi * Mn;
        
        html += createRow("Tensile Strain", et.toFixed(4), et >= 0.005 ? "DUCTILE" : "TRANSITION");
        html += createRow("Flexural Capacity", PhiMn.toFixed(2) + " kNm", PhiMn >= Mu ? "SAFE" : "UNSAFE");

        // 4. Shear & Detailing
        html += `<div class="section-divider">SHEAR & SEISMIC DETAILING</div>`;
        const Vc = 0.17 * 1.0 * Math.sqrt(fc) * b * d / 1000;
        const PhiVc = 0.75 * Vc;
        let shearStat = "OK (No Reinf)";
        
        if(Vu > 0.5 * PhiVc) {
             if (Vu <= PhiVc) {
                 shearStat = `Min Stirrups @ ${(d/2).toFixed(0)}mm`;
             } else {
                const Vs_req = (Vu/0.75) - Vc;
                const Vc_limit = 0.66 * Math.sqrt(fc) * b * d / 1000;
                if (Vs_req > Vc_limit) {
                    shearStat = "FAIL: SEC TOO SMALL";
                } else {
                    const Av = 2 * (Math.PI * Math.pow(ds/2, 2)); 
                    const s_req = (Av * fyt * d) / (Vs_req * 1000);
                    let s_max = (Vs_req > 0.33 * Math.sqrt(fc) * b * d / 1000) ? d/4 : d/2;
                    s_max = Math.min(s_max, 600);
                    const s_final = Math.min(s_req, s_max);
                    shearStat = `Use ${ds}mm @ ${Math.floor(s_final)}mm`;
                }
             }
        }
        html += createRow("Shear Capacity (Phi Vc)", PhiVc.toFixed(2) + " kN", "");
        html += createRow("Shear Design", shearStat, "");

        // Seismic Hoops
        const s_seismic = Math.min(d/4, 8*db, 24*ds, 300);
        html += createRow("Seismic Hoops (Zone 4)", `${ds}mm @ ${Math.floor(s_seismic)}mm`, "");

        if(Tu > 0) {
            const Acp = b*h; const Pcp = 2*(b+h);
            const Tth = 0.75 * 0.083 * Math.sqrt(fc) * (Math.pow(Acp, 2)/Pcp) / 1e6;
            html += createRow("Torsion Check", Tth.toFixed(2) + " kNm", Tu < Tth ? "IGNORE" : "DESIGN REQ");
        }
        
        html += `</div>`;
        document.getElementById('beam-results').innerHTML = html;
        document.getElementById('beam-results').style.display = 'block';
    }

    // --- COLUMN CALCULATION ---
    function calculateColumn() {
        const shape = document.getElementById('c_shape').value;
        const b = parseFloat(document.getElementById('c_b').value);
        const h_dim = parseFloat(document.getElementById('c_h').value);
        const D = parseFloat(document.getElementById('c_D').value);
        const fc = parseFloat(document.getElementById('c_fc').value);
        const fy = parseFloat(document.getElementById('c_fy').value);
        const nb = parseFloat(document.getElementById('c_nb').value);
        const db = parseFloat(document.getElementById('c_db').value);
        const tie = document.getElementById('c_tie').value;
        const dt = parseFloat(document.getElementById('c_dt').value);
        const Pu = parseFloat(document.getElementById('c_Pu').value);
        const M2 = parseFloat(document.getElementById('c_M2').value);
        const M1 = parseFloat(document.getElementById('c_M1').value);
        const Lu = parseFloat(document.getElementById('c_Lu').value) * 1000;
        const k = parseFloat(document.getElementById('c_k').value);
        const sway = parseInt(document.getElementById('c_sway').value);

        const h = shape === 'rect' ? h_dim : D;
        const width = shape === 'rect' ? b : D;
        const Ag = shape === 'rect' ? b*h : (Math.PI * D**2)/4;
        let html = `<div class="result-header">COLUMN ANALYSIS RESULTS</div><div class="result-body">`;

        // Slenderness
        const r = shape === 'rect' ? 0.3 * h : 0.25 * h;
        const klr = (k * Lu) / r;
        let limit = 22.0;
        if(sway === 0) {
            const ratio = M2 !== 0 ? M1/M2 : 1.0;
            limit = Math.max(34 - 12*ratio, 40);
        }
        html += createRow("Slenderness Ratio (kL/r)", klr.toFixed(2), klr > limit ? "SLENDER" : "SHORT");

        // Magnification
        let Mc = Math.max(Math.abs(M2), Pu*(15 + 0.03*h)/1000);
        if(klr > limit && sway === 0) {
            const Ec = 4700 * Math.sqrt(fc);
            const Ig = shape === 'rect' ? (width * Math.pow(h,3))/12 : (Math.PI * Math.pow(D,4))/64;
            const EI = (0.4 * Ec * Ig); 
            const Pc = (Math.pow(Math.PI, 2) * EI) / Math.pow(k*Lu, 2) / 1000;
            const Cm = 0.6 + 0.4*(M2!==0?M1/M2:1);
            let delta = Cm / (1 - Pu/(0.75*Pc));
            delta = Math.max(delta, 1.0);
            Mc *= delta;
            html += createRow("Magnification Factor", delta.toFixed(2), "");
        }
        html += createRow("Design Moment (Mc)", Mc.toFixed(2) + " kNm", "");

        // Capacity
        const Ast = nb * Math.PI * Math.pow(db/2, 2);
        const phi_ax = tie === 'spiral' ? 0.75 : 0.65;
        const alpha = tie === 'spiral' ? 0.85 : 0.80;
        const Pn_max = alpha * (0.85*fc*(Ag-Ast) + Ast*fy) / 1000;
        const PhiPn = phi_ax * Pn_max;
        html += createRow("Max Axial Cap (Phi Pn)", PhiPn.toFixed(0) + " kN", PhiPn >= Pu ? "SAFE" : "UNSAFE");

        // Tie Spacing (Confiment)
        html += `<div class="section-divider">LATERAL TIES (CONFINEMENT)</div>`;
        const dim_min = shape === 'rect' ? Math.min(b,h) : D;
        
        // 1. Vertical Spacing (Non-Seismic)
        const s1 = 16 * db;
        const s2 = 48 * dt;
        const s3 = dim_min;
        const s_vert = Math.min(s1, s2, s3);
        
        // 2. Confinement Zone (Lo) - SMRF
        const s_conf = Math.min(dim_min/4, 6*db, 150); // Zone 4 tight spacing
        
        html += createRow("Mid-Height Spacing", `${dt}mm @ ${Math.floor(s_vert)}mm`, "");
        html += createRow("Confine Zone (Top/Bot)", `${dt}mm @ ${Math.floor(s_conf)}mm`, "");

        html += `</div>`;
        document.getElementById('col-results').innerHTML = html;
        document.getElementById('col-results').style.display = 'block';
    }

    // --- SLAB CALCULATION ---
    function calculateSlab() {
        const mode = document.getElementById('s_mode').value;
        const fc = parseFloat(document.getElementById('s_fc').value);
        const fy = parseFloat(document.getElementById('s_fy').value);
        const h = parseFloat(document.getElementById('s_h').value);
        const cc = parseFloat(document.getElementById('s_cc').value);
        const db = parseFloat(document.getElementById('s_db').value);
        const DL = parseFloat(document.getElementById('s_DL').value);
        const LL = parseFloat(document.getElementById('s_LL').value);

        const d = h - cc - (db/2);
        const sw = 24.0 * (h/1000);
        const wu = 1.2 * (DL + sw) + 1.6 * LL;

        let results = [];
        const solveStrip = (Mu, label) => {
            let As_min = 0.0018 * 1000 * h;
            if(fy < 420) As_min = 0.0020 * 1000 * h;
            let As_req = 0;
            if(Mu > 0) {
                const phi = 0.90;
                const Rn = (Mu * 1e6) / (phi * 1000 * d**2);
                const term = 1 - (2*Rn)/(0.85*fc);
                if(term < 0) return {s:0, rem:"Conc Crush"};
                const rho = (0.85*fc/fy) * (1 - Math.sqrt(term));
                As_req = rho * 1000 * d;
            }
            const As_final = Math.max(As_req, As_min);
            const Ab = Math.PI * (db/2)**2;
            const s_calc = (Ab / As_final) * 1000;
            const s_max = Mu > 0 ? Math.min(3*h, 450) : Math.min(5*h, 450);
            return {
                loc: label,
                mu: Mu,
                sp: Math.min(s_calc, s_max),
                rem: As_final === As_min ? "Min Steel" : "Flexure"
            };
        };

        let html = `<div class="result-header">SLAB ANALYSIS (wu = ${wu.toFixed(2)} kPa)</div><div class="result-body">`;

        if(mode === '1') {
            const L = parseFloat(document.getElementById('s_L').value);
            const coeff = parseFloat(document.getElementById('s_supp').value);
            const Mu = coeff * wu * L**2;
            results.push(solveStrip(Mu, "Main Reinf"));
            results.push(solveStrip(0, "Temp/Shrink"));
        } else {
            const Lx = parseFloat(document.getElementById('s_Lx').value);
            const col_w = parseFloat(document.getElementById('s_col_w').value);
            const Mfac = wu * Lx**2;
            const cs_n = parseFloat(document.getElementById('s_cn_s').value);
            const cs_p = parseFloat(document.getElementById('s_cp_s').value);
            const cl_n = parseFloat(document.getElementById('s_cn_l').value);
            const cl_p = parseFloat(document.getElementById('s_cp_l').value);
            results.push(solveStrip(cs_n * Mfac, "Short (-)"));
            results.push(solveStrip(cs_p * Mfac, "Short (+)"));
            results.push(solveStrip(cl_n * Mfac, "Long (-)"));
            results.push(solveStrip(cl_p * Mfac, "Long (+)"));

            // PUNCHING SHEAR CHECK
            const Vu_punch = wu * Lx * Lx; 
            const bo = 4 * (col_w + d); // Perimeter at d/2
            const Vc_punch = 0.33 * Math.sqrt(fc) * bo * d / 1000; // kN
            const PhiVc_punch = 0.75 * Vc_punch;
            
            html += `<div class="section-divider">PUNCHING SHEAR (2-WAY)</div>`;
            html += createRow("Shear Perimeter (bo)", bo.toFixed(0) + " mm", "");
            html += createRow("Punching Capacity", PhiVc_punch.toFixed(1) + " kN", "");
            html += createRow("Approx. Demand (Vu)", Vu_punch.toFixed(1) + " kN", PhiVc_punch >= Vu_punch ? "SAFE" : "CHECK SHEAR");
        }

        html += `<div class="table-wrapper"><table><thead><tr><th>Location</th><th>Mu (kNm)</th><th>Spacing</th><th>Remarks</th></tr></thead><tbody>`;
        results.forEach(r => {
            html += `<tr><td>${r.loc}</td><td>${r.mu.toFixed(2)}</td><td><b>${r.sp.toFixed(0)} mm</b></td><td>${r.rem}</td></tr>`;
        });
        html += `</tbody></table></div></div>`;
        document.getElementById('slab-results').innerHTML = html;
        document.getElementById('slab-results').style.display = 'block';
    }
</script>
</body>
</html>
