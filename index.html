<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Structural Design Suite (Ultimate Edition)</title>
    <style>
        :root {
            /* UNIVERSITY OF MINDANAO PALETTE */
            --primary: #800000;   /* UM Maroon */
            --primary-dark: #580000;
            --accent: #FFD700;    /* UM Gold */
            
            --secondary: #333;
            --light: #f4f6f7;
            --success: #27ae60;
            --danger: #c0392b;
            --warning: #f39c12;
            --border: #dcdcdc;
        }

        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; padding: 0; background-color: var(--light); color: #333;
            -webkit-font-smoothing: antialiased;
        }
        
        /* HEADER */
        header { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white; padding: 1.5rem 2rem; border-bottom: 5px solid var(--accent); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .header-content { max-width: 1000px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1.5rem; }
        .app-title { font-size: 1.8rem; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; }
        .app-subtitle { font-size: 0.85rem; opacity: 0.9; margin-top: 5px; color: var(--accent); font-weight: 600; }
        
        /* INFO CARD */
        .student-info { 
            background-color: rgba(0, 0, 0, 0.25); padding: 12px 20px; border-radius: 8px; font-size: 0.9rem;
            border-left: 4px solid var(--accent);
        }
        .info-row { display: flex; align-items: center; margin-bottom: 4px; }
        .info-label { color: var(--accent); font-weight: 700; margin-right: 10px; width: 70px; font-size: 0.75rem; text-transform: uppercase; }
        .info-val { font-weight: 600; color: white; letter-spacing: 0.5px; }

        /* NAV */
        nav { background-color: var(--secondary); display: flex; justify-content: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        nav button { 
            background: none; border: none; color: rgba(255,255,255,0.7); padding: 1rem 2.5rem; 
            cursor: pointer; font-size: 1rem; font-weight: 700; transition: all 0.3s; 
            border-bottom: 4px solid transparent; text-transform: uppercase;
        }
        nav button:hover { color: var(--accent); background-color: rgba(255,255,255,0.05); }
        nav button.active { color: white; border-bottom-color: var(--accent); background-color: rgba(255,255,255,0.1); }
        @media (max-width: 600px) { nav button { padding: 1rem 0.5rem; font-size: 0.8rem; flex: 1; } }

        /* MAIN */
        main { max-width: 900px; margin: 2rem auto; padding: 0 1rem; padding-bottom: 4rem; }
        .module { display: none; background: white; padding: 2.5rem; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); animation: fadeIn 0.4s ease-out; border-top: 4px solid var(--primary); }
        .module.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { border-bottom: 2px solid #eee; padding-bottom: 0.8rem; color: var(--primary); margin-top: 0; font-size: 1.5rem; font-weight: 700; }
        h3 { color: #555; margin-top: 2rem; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; border-left: 4px solid var(--accent); padding-left: 10px; }

        .input-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        @media (max-width: 480px) { .input-grid { grid-template-columns: 1fr; gap: 1rem; } }

        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 0.85rem; font-weight: 700; margin-bottom: 0.5rem; color: #666; }
        .form-group input, .form-group select { padding: 12px; border: 1px solid var(--border); border-radius: 4px; font-size: 1rem; background-color: #fff; width: 100%; transition: border 0.3s; }
        .form-group input:focus { border-color: var(--primary); outline: none; }

        .btn-calc { width: 100%; padding: 1.2rem; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 1.1rem; font-weight: 800; cursor: pointer; margin-top: 1.5rem; text-transform: uppercase; letter-spacing: 1px; transition: all 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .btn-calc:hover { background-color: var(--primary-dark); color: var(--accent); transform: translateY(-2px); }
        .btn-calc:active { transform: translateY(1px); }

        /* RESULTS */
        .results-box { margin-top: 2.5rem; background-color: #fff; border: 1px solid #ddd; border-left: 6px solid var(--primary); border-radius: 6px; display: none; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .result-header { background-color: var(--primary); color: white; padding: 1rem 1.5rem; font-weight: bold; font-size: 1.1rem; }
        .result-body { padding: 1.5rem; }
        .result-row { display: flex; justify-content: space-between; align-items: center; padding: 0.9rem 0; border-bottom: 1px solid #f0f0f0; flex-wrap: wrap; gap: 10px; }
        .result-row:last-child { border-bottom: none; }
        .result-label { font-weight: 600; color: #444; }
        
        .tag { padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 800; color: white; text-transform: uppercase; letter-spacing: 0.5px; }
        .tag.pass { background-color: var(--success); }
        .tag.fail { background-color: var(--danger); }
        .tag.warn { background-color: var(--warning); }
        .tag.info { background-color: var(--primary); }
        
        .section-divider { background: #f9f9f9; color: var(--primary); padding: 8px 12px; font-size: 0.85rem; font-weight: 800; text-transform: uppercase; margin-top: 1.5rem; border-radius: 4px; border-left: 4px solid var(--accent); }

        /* CANVAS & VISUALS */
        .chart-container { 
            margin-top: 20px; 
            background: #fff; 
            border: 1px solid #eee; 
            padding: 15px; 
            border-radius: 4px;
            text-align: center;
        }
        canvas { max-width: 100%; height: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .chart-legend { font-size: 0.8rem; margin-top: 5px; color: #666; display: flex; justify-content: center; gap: 15px; flex-wrap:wrap;}
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
        
        .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-top: 1rem; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 500px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        th { background-color: #f8f8f8; color: var(--primary); font-weight: 800; text-transform: uppercase; font-size: 0.8rem; }
    </style>
</head>
<body>

<header>
    <div class="header-content">
        <div>
            <div class="app-title">STRUCTURAL DESIGN PROPOSAL</div>
            <div class="app-subtitle">NSCP 2015 / ACI 318-14 (ZONE 4 READY)</div>
        </div>
        <div class="student-info">
            <div class="info-row"><span class="info-label">Project</span> <span id="display-project" class="info-val">...</span></div>
            <div class="info-row"><span class="info-label">Name</span> <span id="display-name" class="info-val">...</span></div>
            <div class="info-row"><span class="info-label">Subject</span> <span id="display-subject" class="info-val">...</span></div>
        </div>
    </div>
</header>

<nav>
    <button class="active" onclick="switchTab('beam')">BEAM</button>
    <button onclick="switchTab('column')">COLUMN</button>
    <button onclick="switchTab('slab')">SLAB</button>
</nav>

<main>
    <section id="beam" class="module active">
        <h2>Beam Design Module</h2>
        <div class="form-group" style="margin-bottom: 1.5rem;">
            <label>Design Type</label>
            <select id="b_type" onchange="toggleBeamType()">
                <option value="singly">Singly Reinforced</option>
                <option value="doubly">Doubly Reinforced</option>
            </select>
        </div>
        <h3>1. Geometry & Materials</h3>
        <div class="input-grid">
            <div class="form-group"><label>Width b (mm)</label><input type="number" id="b_b" value="300"></div>
            <div class="form-group"><label>Depth h (mm)</label><input type="number" id="b_h" value="500"></div>
            <div class="form-group"><label>Cover (mm)</label><input type="number" id="b_cc" value="40"></div>
            <div class="form-group"><label>fc' (MPa)</label><input type="number" id="b_fc" value="28"></div>
            <div class="form-group"><label>Main fy (MPa)</label><input type="number" id="b_fy" value="414"></div>
            <div class="form-group"><label>Stirrup fyt (MPa)</label><input type="number" id="b_fyt" value="275"></div>
        </div>
        <h3>2. Tension Reinforcement</h3>
        <div class="input-grid">
            <div class="form-group"><label>Tens. Bars (N)</label><input type="number" id="b_n" value="3"></div>
            <div class="form-group"><label>Bar Dia (mm)</label><input type="number" id="b_db" value="20"></div>
            <div class="form-group"><label>Stirrup Dia (mm)</label><input type="number" id="b_ds" value="10"></div>
        </div>
        <div id="beam-comp-group" style="display:none;">
            <h3>3. Compression Reinforcement</h3>
            <div class="input-grid">
                <div class="form-group"><label>Comp. Bars (N')</label><input type="number" id="b_np" value="2"></div>
                <div class="form-group"><label>Comp. Bar Dia (mm)</label><input type="number" id="b_dbp" value="20"></div>
                <div class="form-group"><label>Dist to Top d' (mm)</label><input type="number" id="b_dp" value="65"></div>
            </div>
        </div>
        <h3>4. Loads & Span</h3>
        <div class="input-grid">
            <div class="form-group"><label>Moment Mu (kNm)</label><input type="number" id="b_Mu" value="150"></div>
            <div class="form-group"><label>Shear Vu (kN)</label><input type="number" id="b_Vu" value="100"></div>
            <div class="form-group"><label>Torsion Tu (kNm)</label><input type="number" id="b_Tu" value="0"></div>
            <div class="form-group"><label>Span Length (m)</label><input type="number" id="b_L" value="6.0"></div>
            <div class="form-group"><label>Support Type</label>
                <select id="b_supp">
                    <option value="1">Simply Supported</option>
                    <option value="2">One End Continuous</option>
                    <option value="3">Both Ends Continuous</option>
                    <option value="4">Cantilever</option>
                </select>
            </div>
        </div>
        <button class="btn-calc" onclick="calculateBeam()">ANALYZE BEAM</button>
        <div id="beam-results" class="results-box"></div>
    </section>

    <section id="column" class="module">
        <h2>Column Design Module</h2>
        <h3>1. Geometry</h3>
        <div class="input-grid">
            <div class="form-group"><label>Shape</label>
                <select id="c_shape" onchange="toggleColInputs()"><option value="rect">Rectangular</option><option value="circ">Circular</option></select>
            </div>
            <div class="form-group" id="c_b_grp"><label>Width (mm)</label><input type="number" id="c_b" value="400"></div>
            <div class="form-group" id="c_h_grp"><label>Depth (mm)</label><input type="number" id="c_h" value="400"></div>
            <div class="form-group" id="c_D_grp" style="display:none"><label>Diameter (mm)</label><input type="number" id="c_D" value="400"></div>
            <div class="form-group"><label>Cover (mm)</label><input type="number" id="c_cc" value="40"></div>
        </div>
        <h3>2. Material & Reinf</h3>
        <div class="input-grid">
            <div class="form-group"><label>fc' (MPa)</label><input type="number" id="c_fc" value="28"></div>
            <div class="form-group"><label>fy (MPa)</label><input type="number" id="c_fy" value="415"></div>
            <div class="form-group"><label>Total Bars</label><input type="number" id="c_nb" value="8"></div>
            <div class="form-group"><label>Bar Dia (mm)</label><input type="number" id="c_db" value="20"></div>
            <div class="form-group"><label>Tie Type</label>
                <select id="c_tie"><option value="tied">Tied</option><option value="spiral">Spiral</option></select>
            </div>
            <div class="form-group"><label>Tie Dia (mm)</label><input type="number" id="c_dt" value="10"></div>
        </div>
        <h3>3. Loads & Slenderness</h3>
        <div class="input-grid">
            <div class="form-group"><label>Axial Pu (kN)</label><input type="number" id="c_Pu" value="1000"></div>
            <div class="form-group"><label>Moment Mu (kNm)</label><input type="number" id="c_M2" value="150"></div>
            <div class="form-group"><label>Unbraced L (m)</label><input type="number" id="c_Lu" value="3.0"></div>
            <div class="form-group"><label>Sway Frame?</label>
                <select id="c_sway"><option value="0">No</option><option value="1">Yes</option></select>
            </div>
        </div>
        <button class="btn-calc" onclick="calculateColumn()">ANALYZE & PLOT P-M CURVE</button>
        <div id="col-results" class="results-box"></div>
    </section>

    <section id="slab" class="module">
        <h2>Slab Design Module</h2>
        <div class="form-group"><label>Design Method</label>
            <select id="s_mode" onchange="toggleSlabInputs()"><option value="1">One-Way</option><option value="2">Two-Way</option></select>
        </div>
        <h3>Materials & Load</h3>
        <div class="input-grid">
            <div class="form-group"><label>fc' (MPa)</label><input type="number" id="s_fc" value="21"></div>
            <div class="form-group"><label>fy (MPa)</label><input type="number" id="s_fy" value="275"></div>
            <div class="form-group"><label>Thk (mm)</label><input type="number" id="s_h" value="125"></div>
            <div class="form-group"><label>Bar (mm)</label><input type="number" id="s_db" value="10"></div>
            <div class="form-group"><label>SDL (kPa)</label><input type="number" id="s_DL" value="1.5"></div>
            <div class="form-group"><label>LL (kPa)</label><input type="number" id="s_LL" value="1.9"></div>
        </div>
        <div id="slab-oneway">
            <div class="input-grid">
                <div class="form-group"><label>Span (m)</label><input type="number" id="s_L" value="3.0"></div>
                <div class="form-group"><label>Support</label><select id="s_supp"><option value="0.125">Simple</option><option value="0.10">Continuous</option></select></div>
            </div>
        </div>
        <div id="slab-twoway" style="display:none;">
            <div class="input-grid">
                <div class="form-group"><label>Short Lx (m)</label><input type="number" id="s_Lx" value="3.0"></div>
                <div class="form-group"><label>Col Width (mm)</label><input type="number" id="s_col_w" value="400"></div>
            </div>
            <h4>Coefficients</h4>
            <div class="input-grid">
                <div class="form-group"><label>S-Neg</label><input type="number" id="s_cn_s" value="0.0"></div>
                <div class="form-group"><label>S-Pos</label><input type="number" id="s_cp_s" value="0.05"></div>
                <div class="form-group"><label>L-Neg</label><input type="number" id="s_cn_l" value="0.0"></div>
                <div class="form-group"><label>L-Pos</label><input type="number" id="s_cp_l" value="0.05"></div>
            </div>
        </div>
        <button class="btn-calc" onclick="calculateSlab()">ANALYZE SLAB</button>
        <div id="slab-results" class="results-box"></div>
    </section>
</main>

<script>
    // ==========================================
    //       USER CONFIGURATION
    // ==========================================
    const PROJECT_DETAILS = {
        project: "FINAL PROPOSAL",       
        name:    "ENGR. JAN FROYD R. ITEM",    
        subject: "MEPCE 225"        
    };

    window.onload = function() {
        document.getElementById('display-project').textContent = PROJECT_DETAILS.project;
        document.getElementById('display-name').textContent = PROJECT_DETAILS.name;
        document.getElementById('display-subject').textContent = PROJECT_DETAILS.subject;
    };

    function switchTab(tabId) {
        document.querySelectorAll('.module').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
    }

    function toggleColInputs() {
        const shape = document.getElementById('c_shape').value;
        const isRect = shape === 'rect';
        document.getElementById('c_b_grp').style.display = isRect ? 'flex' : 'none';
        document.getElementById('c_h_grp').style.display = isRect ? 'flex' : 'none';
        document.getElementById('c_D_grp').style.display = isRect ? 'none' : 'flex';
    }

    function toggleBeamType() {
        const type = document.getElementById('b_type').value;
        document.getElementById('beam-comp-group').style.display = type === 'doubly' ? 'block' : 'none';
    }

    function toggleSlabInputs() {
        const mode = document.getElementById('s_mode').value;
        document.getElementById('slab-oneway').style.display = mode === '1' ? 'block' : 'none';
        document.getElementById('slab-twoway').style.display = mode === '2' ? 'block' : 'none';
    }

    function createRow(label, val, status) {
        let tagClass = 'info';
        if(['PASS','SAFE','DUCTILE','SHORT','YIELD'].includes(status)) tagClass = 'pass';
        if(['FAIL','UNSAFE','SLENDER','TRANSITION','ELASTIC'].includes(status)) tagClass = 'fail';
        return `<div class="result-row"><span class="result-label">${label}</span><span>${val} ${status ? `<span class="tag ${tagClass}">${status}</span>` : ''}</span></div>`;
    }

    // =========================================================================
    //                          DRAWING FUNCTIONS (CANVAS)
    // =========================================================================
    function drawBeamSection(id, b, h, cc, n, np, db, ds) {
        const c = document.getElementById(id);
        if(!c) return;
        const ctx = c.getContext('2d');
        const w = c.width, ht = c.height;
        ctx.clearRect(0,0,w,ht);
        
        // Scale
        const padding = 40;
        const scale = Math.min((w-2*padding)/b, (ht-2*padding)/h);
        const rectW = b*scale;
        const rectH = h*scale;
        const x0 = (w - rectW)/2;
        const y0 = (ht - rectH)/2;
        
        // Concrete
        ctx.fillStyle = '#e0e0e0';
        ctx.fillRect(x0, y0, rectW, rectH);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.strokeRect(x0, y0, rectW, rectH);
        
        // Stirrup
        const inset = cc * scale;
        ctx.strokeStyle = '#2980b9';
        ctx.lineWidth = 2;
        ctx.strokeRect(x0+inset, y0+inset, rectW-2*inset, rectH-2*inset);
        
        // Bars
        const barRad = (db/2)*scale;
        ctx.fillStyle = '#c0392b';
        
        // Bottom Bars
        const yBot = y0 + rectH - inset - barRad;
        const widthAvail = rectW - 2*inset - 2*barRad;
        for(let i=0; i<n; i++) {
            let cx = x0 + inset + barRad + (n>1 ? (i * widthAvail/(n-1)) : widthAvail/2);
            ctx.beginPath(); ctx.arc(cx, yBot, barRad, 0, 2*Math.PI); ctx.fill();
        }
        
        // Top Bars
        if(np > 0) {
            const yTop = y0 + inset + barRad;
            for(let i=0; i<np; i++) {
                let cx = x0 + inset + barRad + (np>1 ? (i * widthAvail/(np-1)) : widthAvail/2);
                ctx.beginPath(); ctx.arc(cx, yTop, barRad, 0, 2*Math.PI); ctx.fill();
            }
        }
        
        // Labels
        ctx.fillStyle = '#333';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(`b=${b}mm`, w/2, y0-10);
        ctx.fillText(`h=${h}mm`, x0-25, y0+rectH/2);
    }

    function drawColSection(id, shape, b, h, D, cc, n, db) {
        const c = document.getElementById(id);
        if(!c) return;
        const ctx = c.getContext('2d');
        const w = c.width, ht = c.height;
        ctx.clearRect(0,0,w,ht);
        
        const padding = 40;
        const dimX = shape=='rect' ? b : D;
        const dimY = shape=='rect' ? h : D;
        const scale = Math.min((w-2*padding)/dimX, (ht-2*padding)/dimY);
        
        const cx = w/2, cy = ht/2;
        
        ctx.fillStyle = '#e0e0e0';
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        
        if(shape === 'rect') {
            const rw = b*scale, rh = h*scale;
            ctx.fillRect(cx - rw/2, cy - rh/2, rw, rh);
            ctx.strokeRect(cx - rw/2, cy - rh/2, rw, rh);
            
            // Tie
            const inset = cc*scale;
            ctx.strokeStyle = '#2980b9';
            ctx.strokeRect(cx - rw/2 + inset, cy - rh/2 + inset, rw - 2*inset, rh - 2*inset);
            
            // Bars (Simplified perimeter distribution)
            ctx.fillStyle = '#c0392b';
            const barRad = (db/2)*scale;
            // Draw 4 corners
            const bx = rw/2 - inset - barRad;
            const by = rh/2 - inset - barRad;
            // Top/Bot
            const nx = Math.ceil(n/4) + 1; // Approx
            // Just drawing 4 corners + mid for visual
            ctx.beginPath(); ctx.arc(cx-bx, cy-by, barRad, 0, 2*Math.PI); ctx.fill();
            ctx.beginPath(); ctx.arc(cx+bx, cy-by, barRad, 0, 2*Math.PI); ctx.fill();
            ctx.beginPath(); ctx.arc(cx+bx, cy+by, barRad, 0, 2*Math.PI); ctx.fill();
            ctx.beginPath(); ctx.arc(cx-bx, cy+by, barRad, 0, 2*Math.PI); ctx.fill();
            // Text: N bars
        } else {
            const rad = (D*scale)/2;
            ctx.beginPath(); ctx.arc(cx, cy, rad, 0, 2*Math.PI); ctx.fill(); ctx.stroke();
            
            // Spiral
            const inset = cc*scale;
            ctx.beginPath(); ctx.arc(cx, cy, rad-inset, 0, 2*Math.PI); 
            ctx.strokeStyle = '#2980b9'; ctx.stroke();
            
            // Bars
            ctx.fillStyle = '#c0392b';
            const barRad = (db/2)*scale;
            const ringRad = rad - inset - barRad;
            for(let i=0; i<n; i++) {
                const ang = (i / n) * 2 * Math.PI;
                const bx = cx + Math.cos(ang)*ringRad;
                const by = cy + Math.sin(ang)*ringRad;
                ctx.beginPath(); ctx.arc(bx, by, barRad, 0, 2*Math.PI); ctx.fill();
            }
        }
    }

    // =========================================================================
    //                          CALCULATION LOGIC
    // =========================================================================

    // --- BEAM CALCULATION ---
    function calculateBeam() {
        const b = parseFloat(document.getElementById('b_b').value);
        const h = parseFloat(document.getElementById('b_h').value);
        const cc = parseFloat(document.getElementById('b_cc').value);
        const fc = parseFloat(document.getElementById('b_fc').value);
        const fy = parseFloat(document.getElementById('b_fy').value);
        const fyt = parseFloat(document.getElementById('b_fyt').value);
        const L = parseFloat(document.getElementById('b_L').value);
        const supp = parseInt(document.getElementById('b_supp').value);
        const db = parseFloat(document.getElementById('b_db').value);
        const n = parseFloat(document.getElementById('b_n').value);
        const ds = parseFloat(document.getElementById('b_ds').value);
        const Mu = parseFloat(document.getElementById('b_Mu').value);
        const Vu = parseFloat(document.getElementById('b_Vu').value);
        const Tu = parseFloat(document.getElementById('b_Tu').value);
        
        const bType = document.getElementById('b_type').value;
        const isDoubly = bType === 'doubly';
        
        let np = 0, dbp = 0, dp = 0;
        if(isDoubly) {
            np = parseFloat(document.getElementById('b_np').value);
            dbp = parseFloat(document.getElementById('b_dbp').value);
            dp = parseFloat(document.getElementById('b_dp').value);
        }

        const d = h - cc - ds - (db/2);
        const As = n * Math.PI * Math.pow(db/2, 2);
        const Asp = isDoubly ? np * Math.PI * Math.pow(dbp/2, 2) : 0;

        let html = `<div class="result-header">BEAM ANALYSIS: ${isDoubly ? 'DOUBLY' : 'SINGLY'} REINF.</div><div class="result-body">`;

        // DIAGRAM
        html += `<div class="chart-container"><canvas id="beamCanvas" width="250" height="200"></canvas><div style="font-size:0.8rem; margin-top:5px;">Schematic Section</div></div>`;

        // 1. Serviceability (Min Thickness Table 409.3.1.1)
        const denomMap = {1:16, 2:18.5, 3:21, 4:8};
        const denom = denomMap[supp] || 16;
        const mod = 0.4 + (fy/700);
        const h_min = (L * 1000) / denom * mod;
        html += createRow("Min Thickness Req", h_min.toFixed(0) + " mm", h >= h_min ? "PASS" : "FAIL");

        // 2. Development Length
        const ld_calc = (fy / (1.1 * Math.sqrt(fc))) * db; 
        html += createRow("Dev. Length (Ld)", ld_calc.toFixed(0) + " mm", "");

        // 3. Flexural Analysis
        let beta1 = fc <= 28 ? 0.85 : Math.max(0.65, 0.85 - 0.05*(fc-28)/7);
        let c, a, Mn, et, phi, fs_prime;
        
        if (!isDoubly) {
            a = (As * fy) / (0.85 * fc * b);
            c = a / beta1;
            Mn = (As * fy * (d - a/2)) / 1e6;
        } else {
            let c_trial = d / 3; 
            for(let i=0; i<50; i++) {
                let es_prime = 0.003 * (c_trial - dp)/c_trial;
                let fsp = Math.min(Math.max(es_prime * 200000, -fy), fy);
                let Cc = 0.85 * fc * beta1 * c_trial * b;
                let Cs = Asp * (fsp - 0.85*fc);
                let T = As * fy;
                let residual = Cc + Cs - T;
                if(Math.abs(residual) < 100) break;
                c_trial = c_trial - residual / (0.85*fc*beta1*b);
            }
            c = c_trial;
            a = beta1 * c;
            let es_prime = 0.003 * (c - dp)/c;
            fs_prime = Math.min(Math.max(es_prime * 200000, -fy), fy);
            let Cc = 0.85 * fc * a * b;
            let Cs = Asp * (fs_prime - 0.85*fc);
            Mn = (Cc*(d-a/2) + Cs*(d-dp)) / 1e6;
            html += createRow("Comp. Steel Stress", fs_prime.toFixed(1) + " MPa", Math.abs(fs_prime) >= fy ? "YIELD" : "ELASTIC");
        }

        et = 0.003 * ((d - c)/c);
        phi = 0.90;
        if(et <= 0.002) phi = 0.65;
        else if(et < 0.005) phi = 0.65 + (et - 0.002)*(250/3);
        const PhiMn = phi * Mn;
        
        html += createRow("Tensile Strain", et.toFixed(4), et >= 0.005 ? "DUCTILE" : "TRANSITION");
        html += createRow("Flexural Capacity", PhiMn.toFixed(2) + " kNm", PhiMn >= Mu ? "SAFE" : "UNSAFE");

        // 4. Shear & Detailing
        html += `<div class="section-divider">SHEAR & SEISMIC DETAILING</div>`;
        const Vc = 0.17 * 1.0 * Math.sqrt(fc) * b * d / 1000;
        const PhiVc = 0.75 * Vc;
        let shearStat = "OK (No Reinf)";
        let shearTag = "SAFE";
        
        if(Vu > 0.5 * PhiVc) {
             if (Vu <= PhiVc) {
                 shearStat = `Min Stirrups @ ${(d/2).toFixed(0)}mm`;
             } else {
                const Vs_req = (Vu/0.75) - Vc;
                const Vc_limit = 0.66 * Math.sqrt(fc) * b * d / 1000;
                if (Vs_req > Vc_limit) {
                    shearStat = "FAIL: SEC TOO SMALL";
                    shearTag = "UNSAFE";
                } else {
                    const Av = 2 * (Math.PI * Math.pow(ds/2, 2)); 
                    const s_req = (Av * fyt * d) / (Vs_req * 1000);
                    let s_max = (Vs_req > 0.33 * Math.sqrt(fc) * b * d / 1000) ? d/4 : d/2;
                    s_max = Math.min(s_max, 600);
                    const s_final = Math.min(s_req, s_max);
                    shearStat = `Use ${ds}mm @ ${Math.floor(s_final)}mm`;
                }
             }
        }
        html += createRow("Shear Capacity (Phi Vc)", PhiVc.toFixed(2) + " kN", "");
        html += createRow("Shear Design", shearStat, shearTag);

        // Seismic Hoops
        const s_seismic = Math.min(d/4, 8*db, 24*ds, 300);
        html += createRow("Seismic Hoops (Zone 4)", `${ds}mm @ ${Math.floor(s_seismic)}mm`, "");

        if(Tu > 0) {
            const Acp = b*h; const Pcp = 2*(b+h);
            const Tth = 0.75 * 0.083 * Math.sqrt(fc) * (Math.pow(Acp, 2)/Pcp) / 1e6;
            html += createRow("Torsion Check", Tth.toFixed(2) + " kNm", Tu < Tth ? "IGNORE" : "DESIGN REQ");
        }
        
        html += `</div>`;
        document.getElementById('beam-results').innerHTML = html;
        document.getElementById('beam-results').style.display = 'block';
        
        // Draw
        setTimeout(() => drawBeamSection('beamCanvas', b, h, cc, n, np, db, ds), 100);
    }

    // --- COLUMN CALCULATION & PLOTTING ---
    function calculateColumn() {
        const b = parseFloat(document.getElementById('c_b').value);
        const h = parseFloat(document.getElementById('c_h').value);
        const D = parseFloat(document.getElementById('c_D').value);
        const fc = parseFloat(document.getElementById('c_fc').value);
        const fy = parseFloat(document.getElementById('c_fy').value);
        const nb = parseFloat(document.getElementById('c_nb').value);
        const db = parseFloat(document.getElementById('c_db').value);
        const dt = parseFloat(document.getElementById('c_dt').value);
        const Pu = parseFloat(document.getElementById('c_Pu').value);
        const Mu = parseFloat(document.getElementById('c_M2').value);
        const Lu = parseFloat(document.getElementById('c_Lu').value) * 1000;
        const sway = parseInt(document.getElementById('c_sway').value);
        const shape = document.getElementById('c_shape').value;

        const dim = shape=='rect' ? h : D;

        // 1. Basic Analysis
        let html = `<div class="result-header">COLUMN ANALYSIS</div><div class="result-body">`;
        
        // Visual
        html += `<div class="chart-container" style="display:flex; justify-content:space-around;">
            <canvas id="colCanvas" width="100" height="100"></canvas>
            <div><canvas id="pmChart" width="180" height="180"></canvas>
            <div class="chart-legend"><span class="dot" style="background:#27ae60"></span> Cap <span class="dot" style="background:#c0392b"></span> Load</div></div>
        </div>`;

        // Slenderness
        const r = 0.3 * dim;
        const klr = (1.0 * Lu) / r;
        const limit = sway ? 22.0 : 34.0;
        const isSlender = klr > limit;
        html += createRow("Slenderness Ratio", klr.toFixed(2), isSlender ? "SLENDER" : "SHORT");

        // Magnification (Simplified)
        let Mc = Math.max(Math.abs(Mu), Pu*(15 + 0.03*dim)/1000);
        if(isSlender && !sway) {
            let EI = 0.4 * 4700 * Math.sqrt(fc) * (shape=='rect' ? (b*Math.pow(h,3)/12) : (Math.PI*Math.pow(D,4)/64));
            let Pc = (Math.pow(Math.PI,2)*EI) / Math.pow(Lu,2) / 1000;
            let delta = 1.0 / (1 - Pu/(0.75*Pc));
            delta = Math.max(delta, 1.0);
            Mc *= delta;
            html += createRow("Magnification", delta.toFixed(2), "");
        }
        html += createRow("Design Moment (Mc)", Mc.toFixed(2) + " kNm", "");

        // Confinement
        html += `<div class="section-divider">CONFINEMENT (ZONE 4)</div>`;
        const so = Math.min(shape=='rect'?Math.min(b,h)/4:D/4, 6*db, 150);
        html += createRow("Confine Zone (Lo)", `${dt}mm @ ${Math.floor(so)}mm`, "");

        // 2. Interaction Diagram Data Generation
        const d = dim - 40 - 10 - db/2; // d approx
        const d_prime = 40 + 10 + db/2;
        const As_total = nb * Math.PI * Math.pow(db/2, 2);
        const As_face = As_total / 2; // Assume 2 faces for calculation
        const beta1 = fc <= 28 ? 0.85 : 0.65; // Simplified beta

        let points = [];
        let c_vals = [dim*2, dim, dim*0.8, dim*0.6, dim*0.4, dim*0.2, dim*0.1, 0];
        const area = shape=='rect' ? b*h : Math.PI*D*D/4;
        
        c_vals.forEach(c => {
            let Pn, Mn, phi;
            if(c >= dim*1.5) { // Pure Comp
                Pn = 0.80 * (0.85*fc*(area - As_total) + As_total*fy); // Tied
                Mn = 0;
                phi = 0.65;
            } else if (c <= 0.01) { // Pure Tension
                Pn = -As_total * fy;
                Mn = 0;
                phi = 0.90;
            } else {
                let a = beta1 * c;
                let Cc = shape=='rect' ? 0.85 * fc * a * b : 0.85*fc*area*0.7; // Circle approx
                let es_s = 0.003 * (d - c)/c;
                let es_p = 0.003 * (c - d_prime)/c;
                let fs_s = Math.min(Math.max(es_s * 200000, -fy), fy);
                let fs_p = Math.min(Math.max(es_p * 200000, -fy), fy);
                
                let F_cs = As_face * (fs_p - 0.85*fc);
                let F_ts = As_face * fs_s * -1; 
                
                Pn = Cc + F_cs + F_ts;
                Mn = Cc*(dim/2 - a/2) + F_cs*(dim/2 - d_prime) - F_ts*(d - dim/2);
                
                let et = 0.003 * (d-c)/c;
                if(et <= 0.002) phi = 0.65;
                else if(et >= 0.005) phi = 0.90;
                else phi = 0.65 + (et-0.002)*(250/3);
            }
            points.push({x: Math.abs(Mn*phi/1e6), y: Pn*phi/1000});
        });

        html += `</div>`;
        document.getElementById('col-results').innerHTML = html;
        document.getElementById('col-results').style.display = 'block';

        drawInteractionDiagram(points, Mc, Pu);
        drawColSection('colCanvas', shape, b, h, D, 40, nb, db);
    }

    function drawInteractionDiagram(points, Mu, Pu) {
        const c = document.getElementById('pmChart');
        const ctx = c.getContext('2d');
        const w = c.width, h = c.height;
        ctx.clearRect(0,0,w,h);
        
        const maxY = Math.max(...points.map(p => p.y)) * 1.2;
        const maxX = Math.max(...points.map(p => p.x)) * 1.2;
        
        // Axis
        ctx.beginPath();
        ctx.moveTo(30, 10); ctx.lineTo(30, h-20); // Y
        ctx.lineTo(w-10, h-20); // X
        ctx.strokeStyle = '#333';
        ctx.stroke();
        
        // Curve
        ctx.beginPath();
        points.forEach((p, i) => {
            let px = 30 + (p.x / maxX) * (w-40);
            let py = (h-20) - (p.y / maxY) * (h-30);
            if(i==0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
        });
        ctx.strokeStyle = '#27ae60';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Point
        let dx = 30 + (Math.abs(Mu) / maxX) * (w-40);
        let dy = (h-20) - (Pu / maxY) * (h-30);
        ctx.beginPath();
        ctx.arc(dx, dy, 4, 0, 2*Math.PI);
        ctx.fillStyle = '#c0392b';
        ctx.fill();
    }

    // --- SLAB CALCULATION ---
    function calculateSlab() {
        const fc = parseFloat(document.getElementById('s_fc').value);
        const fy = parseFloat(document.getElementById('s_fy').value);
        const h = parseFloat(document.getElementById('s_h').value);
        const db = parseFloat(document.getElementById('s_db').value);
        const DL = parseFloat(document.getElementById('s_DL').value);
        const LL = parseFloat(document.getElementById('s_LL').value);
        const L = parseFloat(document.getElementById('s_L').value); 
        const mode = document.getElementById('s_mode').value;
        
        const d = h - 20 - db/2;
        const wu = 1.2*(DL + 24*h/1000) + 1.6*LL;
        const Mu = (1/8) * wu * L * L; 
        
        let html = `<div class="result-header">SLAB ANALYSIS</div><div class="result-body">`;
        
        html += createRow("Factored Load", wu.toFixed(2) + " kPa", "");
        
        // Flexure Logic (Shared)
        const As_min = 0.0018 * 1000 * h;
        
        const solve = (M) => {
            const phi = 0.90;
            const Rn = (M * 1e6) / (phi * 1000 * d**2);
            const term = 1 - (2*Rn)/(0.85*fc);
            let As = As_min;
            if(term > 0) {
                const rho = (0.85*fc/fy) * (1 - Math.sqrt(term));
                As = Math.max(rho * 1000 * d, As_min);
            }
            const s = Math.min((Math.PI*db*db/4) / As * 1000, 3*h, 450);
            return Math.floor(s);
        };

        if(mode == '1') {
            html += createRow("Main Steel", `Use ${db}mm @ ${solve(Mu)}mm`, "");
            html += createRow("Temp/Shrink", `Use ${db}mm @ ${solve(0)}mm`, "");
        } else {
            // Two Way
            const Lx = parseFloat(document.getElementById('s_Lx').value);
            const col = parseFloat(document.getElementById('s_col_w').value);
            
            // Punching Shear
            html += `<div class="section-divider">PUNCHING SHEAR</div>`;
            const Vu = wu * Lx * Lx; // Conservative trib area
            const bo = 4 * (col + d);
            const Vc = 0.33 * Math.sqrt(fc) * bo * d / 1000;
            const PhiVc = 0.75 * Vc;
            
            html += createRow("Punching Demand", Vu.toFixed(1) + " kN", "");
            html += createRow("Punching Cap", PhiVc.toFixed(1) + " kN", PhiVc >= Vu ? "SAFE" : "FAIL");
            
            html += `<div class="section-divider">REINFORCEMENT</div>`;
            // Simplified coeff display
            const M_neg = 0.07 * wu * Lx * Lx; // Avg coeff
            html += createRow("Neg Moment Bar", `Use ${db}mm @ ${solve(M_neg)}mm`, "");
        }
        
        html += `</div>`;
        document.getElementById('slab-results').innerHTML = html;
        document.getElementById('slab-results').style.display = 'block';
    }
</script>
</body>
</html>
